<!DOCTYPE html>
<html>
  <head>
    <!-- 소켓 통신 라이브러리 -->
    <script
      src="https://cdn.socket.io/4.6.0/socket.io.min.js"
      integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+"
      crossorigin="anonymous"
    ></script>

    <!-- Snappy 압축 해제 라이브러리 -->
    <script src="https://cdn.ssapi.kr/service/snappyjs.min.js"></script>
  </head>

  <body>
    <script>
      // Snappy 초기화
      const Snappy = window.snappy;

      const socket = io("https://socket.ssapi.kr", {
        transports: ["websocket"],
        timeout: 5000,
      });

      // 소켓 연결
      socket.on("connect", () => {
        console.log("소켓 연결 성공");
        socket.emit("login", "leaf_rin_45DAFS9A1VR");
      });

      // 소켓 연결 끊김
      socket.on("disconnect", (reason) => {
        console.error("소켓 연결 끊김", reason);
      });

      // 메시지 수신 및 압축 해제
      socket.on("chat", (compressedData) => {
        try {
          // 수신된 데이터 압축 해제
          const decompressedData = SnappyJS.uncompress(compressedData);

          // 압축 해제된 데이터 JSON으로 파싱
          const data = JSON.parse(new TextDecoder().decode(decompressedData));
          6;

          console.log("수신된 압축 해제 메시지", data);
        } catch (error) {
          console.error("메시지 압축 해제 중 오류:", error);
        }
      });

      // 후원 데이터 수신 및 압축 해제
      socket.on("donation", (compressedData) => {
        try {
          // 수신된 데이터 압축 해제
          const decompressedData = SnappyJS.uncompress(compressedData);

          // 압축 해제된 데이터 JSON으로 파싱
          const data = JSON.parse(new TextDecoder().decode(decompressedData));

          console.log("수신된 압축 해제 후원 데이터", data);
        } catch (error) {
          console.error("후원 데이터 압축 해제 중 오류:", error);
        }
      });
    </script>
  </body>
</html>
